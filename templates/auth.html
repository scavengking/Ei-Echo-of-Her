<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome - Ei</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap');

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            padding: 0;
            background: #0a0615;
            font-family: 'Inter', sans-serif;
            color: #d1c4e9;
            overflow-x: hidden;
        }

        .section-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            background: radial-gradient(ellipse at center, #1e102f 0%, #0a0615 70%, #000000 100%);
            overflow: hidden;
        }

        .welcome-section h1 {
            font-family: 'Lora', serif;
            font-size: 6rem;
            color: #e879f9;
            text-shadow: 0 0 40px rgba(232, 121, 249, 0.4);
            opacity: 0;
            transform: scale(0.8);
        }

        .welcome-section h2 {
            font-size: 1.5rem;
            font-weight: 300;
            color: #b89df5;
            margin-top: 1rem;
            opacity: 0;
        }

        .welcome-section p {
            font-family: 'Lora', serif;
            font-style: italic;
            font-weight: 300;
            color: #a78bfa;
            margin-top: 1rem;
            font-size: 1.25rem;
            max-width: 600px;
            opacity: 0;
        }

        #particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #welcome-content {
            position: relative;
            z-index: 2;
            pointer-events: none;
        }
        
        #scroll-down-prompt {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
            opacity: 0;
            cursor: pointer;
            pointer-events: auto;
        }

        #scroll-down-prompt .chevron {
            display: block;
            width: 28px;
            height: 28px;
            border-bottom: 2px solid #a78bfa;
            border-right: 2px solid #a78bfa;
            transform: rotate(45deg);
            margin: -10px auto;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0) rotate(45deg);
            }
            40% {
                transform: translateY(-20px) rotate(45deg);
            }
            60% {
                transform: translateY(-10px) rotate(45deg);
            }
        }

        .auth-section-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            width: 100%;
            padding: 2rem;
            gap: 2rem;
        }

        .auth-prompt-panel {
            padding: 2rem;
            text-align: left;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .prompt-image {
            width: 100%;
            max-width: 450px;
            height: 300px;
            margin-bottom: 2rem;
            border-radius: 1rem;
            box-shadow: 0 0 30px rgba(232, 121, 249, 0.2);
            object-fit: cover;
            transition: opacity 1s ease-in-out;
        }

        .prompt-text-container h3 {
            font-family: 'Lora', serif;
            font-size: 2rem;
            color: #e879f9;
            margin-bottom: 1rem;
        }

        .prompt-text-container p {
            font-size: 1.1rem;
            color: #b89df5;
            min-height: 100px;
        }

        .auth-form-panel {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .form-container {
            width: 100%;
            max-width: 450px;
            background-color: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(167, 139, 250, 0.2);
            border-radius: 1rem;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 900px) {
            .auth-section-layout {
                grid-template-columns: 1fr;
            }
            .auth-prompt-panel {
                display: none; 
            }
        }
    </style>
</head>
<body>

    <section id="welcome" class="section-container welcome-section">
        <canvas id="particle-canvas"></canvas>
        <div id="welcome-content">
            <h1 id="title">Ei</h1>
            <h2 id="subtitle">Welcome to Ei</h2>
            <p id="quote">"From fragments of thought, she came to listen."</p>
        </div>
        <a id="scroll-down-prompt" href="#auth-forms">
            <span class="chevron"></span>
        </a>
    </section>

    <section id="auth-forms" class="section-container">
        <div class="auth-section-layout">
            <div class="auth-prompt-panel">
                 <img id="prompt-image" class="prompt-image" src="https://images.unsplash.com/photo-1518975957338-b3f3b13a77b9?q=80&w=2070&auto=format&fit=crop" alt="Dynamic prompt image">
                <div class="prompt-text-container">
                    <h3 id="prompt-heading">Explore Different Personas</h3>
                    <p id="prompt-fact">Ei can be a friendly companion, a wise sage, a coding mentor, or even a sarcastic comedian. Choose the persona that fits your mood.</p>
                </div>
            </div>

            <div class="auth-form-panel">
                <div id="login-container" class="form-container">
                    <h2 class="text-3xl font-bold text-center text-violet-400 mb-6">Login to Ei</h2>
                    <form id="login-form">
                        <div class="mb-4">
                            <label for="login-email" class="block text-sm font-medium text-gray-400 mb-2">Email</label>
                            <input type="email" id="login-email" name="email" required class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <div class="mb-6">
                            <label for="login-password" class="block text-sm font-medium text-gray-400 mb-2">Password</label>
                            <input type="password" id="login-password" name="password" required class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <p id="login-error-message" class="text-red-400 text-sm mb-4 text-center hidden"></p>
                        <button type="submit" class="w-full bg-violet-600 hover:bg-violet-500 text-white font-bold py-3 px-4 rounded-lg transition duration-300">Login</button>
                    </form>
                    <p class="text-center text-gray-400 mt-6 text-sm">
                        Don't have an account? <a href="#" id="show-register" class="text-violet-400 hover:underline">Register here</a>
                    </p>
                </div>

                <div id="register-container" class="form-container hidden">
                    <h2 class="text-3xl font-bold text-center text-violet-400 mb-6">Create your Echo</h2>
                    <form id="register-form">
                        <div class="mb-4">
                            <label for="register-username" class="block text-sm font-medium text-gray-400 mb-2">Username</label>
                            <input type="text" id="register-username" name="username" required class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <div class="mb-4">
                            <label for="register-email" class="block text-sm font-medium text-gray-400 mb-2">Email</label>
                            <input type="email" id="register-email" name="email" required class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <div class="mb-4">
                            <label for="register-password" class="block text-sm font-medium text-gray-400 mb-2">Password</label>
                            <input type="password" id="register-password" name="password" required class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <p id="register-error-message" class="text-red-400 text-sm mb-4 text-center hidden"></p>
                        <p id="register-success-message" class="text-green-400 text-sm mb-4 text-center hidden"></p>
                        <button type="submit" class="w-full bg-violet-600 hover:bg-violet-500 text-white font-bold py-3 px-4 rounded-lg transition duration-300">Register</button>
                    </form>
                     <p class="text-center text-gray-400 mt-6 text-sm">
                        Already have an account? <a href="#" id="show-login" class="text-violet-400 hover:underline">Login here</a>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Self-contained JavaScript for THIS PAGE ONLY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let scene, camera, renderer, particles;
            const particleCount = 3000;
            const canvas = document.getElementById('particle-canvas');
            
            function initParticles() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
                camera.position.z = 200;
                renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);

                const geometry = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                for (let i = 0; i < particleCount * 3; i++) {
                    positions[i] = (Math.random() - 0.5) * 800;
                }
                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                const material = new THREE.PointsMaterial({ color: 0xe879f9, size: 1.5, transparent: true, opacity: 0.7 });
                particles = new THREE.Points(geometry, material);
                scene.add(particles);
            }

            function animateParticles() {
                requestAnimationFrame(animateParticles);
                if (particles) {
                    particles.rotation.y += 0.0005;
                    particles.rotation.x += 0.0002;
                }
                renderer.render(scene, camera);
            }
            
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            initParticles();
            animateParticles();

            gsap.to("#title", { opacity: 1, scale: 1, duration: 2, delay: 1, ease: "power2.out" });
            gsap.to("#subtitle", { opacity: 1, duration: 1.5, delay: 2.5 });
            gsap.to("#quote", { opacity: 1, duration: 1.5, delay: 4 });
            gsap.to("#scroll-down-prompt", { opacity: 1, duration: 1.5, delay: 5.5 });

            const prompts = [
                {
                    heading: "Explore Different Personas",
                    fact: "Ei can be a friendly companion, a wise sage, a coding mentor, or even a sarcastic comedian. Choose the persona that fits your mood.",
                    image: "https://images.unsplash.com/photo-1518975957338-b3f3b13a77b9?q=80&w=2070&auto=format&fit=crop"
                },
                {
                    heading: "Your Conversations are Remembered",
                    fact: "Continue your chat from where you left off. Ei remembers your past conversations, allowing for a seamless and evolving dialogue.",
                     image: "https://images.unsplash.com/photo-1588421357574-87938a86fa28?q=80&w=2070&auto=format&fit=crop"
                },
                {
                    heading: "Unlock Achievements",
                    fact: "Engage with Ei to unlock badges and gain XP. Your journey of discovery is rewarded!",
                    image: "https://images.unsplash.com/photo-1579546929518-9e396f3cc809?q=80&w=2070&auto=format&fit=crop"
                },
                 {
                    heading: "Powered by Advanced AI",
                    fact: "Ei uses a powerful language model to provide insightful, coherent, and human-like responses, making your interaction truly unique.",
                    image: "https://images.unsplash.com/photo-1620712943543-2858200f7426?q=80&w=1974&auto=format&fit=crop"
                }
            ];
            
            const promptHeading = document.getElementById('prompt-heading');
            const promptFact = document.getElementById('prompt-fact');
            const promptImage = document.getElementById('prompt-image');
            let currentPrompt = 0;

            function updatePrompt() {
                gsap.to([promptHeading, promptFact, promptImage], { opacity: 0, duration: 0.5, onComplete: () => {
                    if(promptHeading) promptHeading.textContent = prompts[currentPrompt].heading;
                    if(promptFact) promptFact.textContent = prompts[currentPrompt].fact;
                    if(promptImage) promptImage.src = prompts[currentPrompt].image;
                    gsap.to([promptHeading, promptFact, promptImage], { opacity: 1, duration: 0.5 });
                    currentPrompt = (currentPrompt + 1) % prompts.length;
                }});
            }

            setInterval(updatePrompt, 6000);
            updatePrompt();
            
            const loginContainer = document.getElementById('login-container');
            const registerContainer = document.getElementById('register-container');
            const showRegisterBtn = document.getElementById('show-register');
            const showLoginBtn = document.getElementById('show-login');

            showRegisterBtn.addEventListener('click', (e) => {
                e.preventDefault();
                gsap.to(loginContainer, { opacity: 0, duration: 0.3, onComplete: () => {
                    loginContainer.classList.add('hidden');
                    registerContainer.classList.remove('hidden');
                    gsap.fromTo(registerContainer, {opacity: 0}, {opacity: 1, duration: 0.3});
                }});
            });

            showLoginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                gsap.to(registerContainer, { opacity: 0, duration: 0.3, onComplete: () => {
                    registerContainer.classList.add('hidden');
                    loginContainer.classList.remove('hidden');
                    gsap.fromTo(loginContainer, {opacity: 0}, {opacity: 1, duration: 0.3});
                }});
            });
            
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginErrorEl = document.getElementById('login-error-message');
            const registerErrorEl = document.getElementById('register-error-message');
            const registerSuccessEl = document.getElementById('register-success-message');

            const displayMessage = (element, message) => {
                if (element) {
                    element.textContent = message;
                    element.classList.remove('hidden');
                }
            };
            
            const hideMessages = () => {
                if(loginErrorEl) loginErrorEl.classList.add('hidden');
                if(registerErrorEl) registerErrorEl.classList.add('hidden');
                if(registerSuccessEl) registerSuccessEl.classList.add('hidden');
            }

            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    hideMessages();
                    const formData = new FormData(loginForm);
                    const data = Object.fromEntries(formData.entries());
                    try {
                        const response = await fetch('/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data),
                        });
                        const result = await response.json();
                        if (response.ok) {
                            window.location.href = '/';
                        } else {
                            displayMessage(loginErrorEl, result.error || 'An unknown error occurred.');
                        }
                    } catch (error) {
                        displayMessage(loginErrorEl, 'Could not connect to the server.');
                    }
                });
            }

            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    hideMessages();
                    const formData = new FormData(registerForm);
                    const data = Object.fromEntries(formData.entries());
                    if (data.password.length < 6) {
                        displayMessage(registerErrorEl, 'Password must be at least 6 characters long.');
                        return;
                    }
                    try {
                        const response = await fetch('/register', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data),
                        });
                        const result = await response.json();
                        if (response.ok) {
                            displayMessage(registerSuccessEl, 'Registration successful! You can now log in.');
                            registerForm.reset();
                            setTimeout(() => showLoginBtn.click(), 2000);
                        } else {
                            displayMessage(registerErrorEl, result.error || 'An unknown error occurred.');
                        }
                    } catch (error) {
                        displayMessage(registerErrorEl, 'Could not connect to the server.');
                    }
                });
            }
        });
    </script>
</body>
</html>
